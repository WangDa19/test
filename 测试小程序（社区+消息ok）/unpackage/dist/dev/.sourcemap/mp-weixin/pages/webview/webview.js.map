{"version":3,"sources":["uni-app:///main.js","webpack:///H:/测试小程序/pages/webview/webview.vue?42d4","webpack:///H:/测试小程序/pages/webview/webview.vue?6a68","webpack:///H:/测试小程序/pages/webview/webview.vue?e273","webpack:///H:/测试小程序/pages/webview/webview.vue?42a2","uni-app:///pages/webview/webview.vue","webpack:///H:/测试小程序/pages/webview/webview.vue?d1e1","webpack:///H:/测试小程序/pages/webview/webview.vue?b28d"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","url","title","captureTimer","processCount","maxCaptures","captureInterval","lastCaptureTime","hasRecognized","manualInputShown","loading","onLoad","uni","setTimeout","onUnload","clearTimeout","onShow","controls","methods","handleMessage","console","content","confirmText","cancelText","success","schoolName","captureAndRecognize","currentWebview","confirmSchool","icon","getSchoolInfoManually","editable","placeholderText","saveEducationInfo","selectedSchool","educationInfo","verified","uniCloud","name","action","userId","stopAutoCapture","clearInterval","getCurrentWebview","captureScreen","getSchoolInfoFromWebview","debugHtml","captureAndRecognizeDOM","handlePageLoad","handlePageError","fail","captureRes","filePath","encoding","base64","image","type","ocrResult","schoolInfo","result","major","degree","words"],"mappings":";;;;;;;;;;;;;AAAA;AAE2D;AAC3D;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,gBAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAoH;AACpH;AAC2D;AACL;AACa;;;AAGnE;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,6EAAM;AACR,EAAE,kFAAM;AACR,EAAE,2FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,sFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAimB,CAAgB,2nBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eCoBrnB;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IAAA;IACA;MACA;MACAC;QACAV;MACA;IACA;IACA;MACA;MACAU;QACAV;MACA;IACA;;IAEA;IACAW;MACA;IACA;EACA;EACAC;IACA;MACAC;MACA;IACA;EACA;EACAC;IACA;MACA;MACA;QACAC;MACA;IACA;EACA;EACAC;IACAC;MAAA;MACAC;MAEA;MACA;QACA;QAEAR;UACAV;UACAmB;UACAC;UACAC;UACAC;YACA;cACA;gBACAC;cACA;YACA;cACA;YACA;UACA;QACA;MACA;IACA;IACAC;MAAA;MACA;MAEAd;QACAV;MACA;MAEA,oRAOA;MAEA,6vDA2CA;MAEA;QACA;QACA;UACAyB;YACA;cACAf;cACA;cACA;YACA;cACAe;gBACAf;gBAEA;kBACAQ;kBACA;kBACA;gBACA;kBACAA;kBACA;gBACA;cACA;YACA;UACA;QACA;UACAR;UACA;QACA;MACA;QACAA;QACA;MACA;IACA;IACAgB;MACA;QACAH;MACA;MAEAb;QACAV;QACA2B;MACA;MAEAhB;QACAD;MACA;IACA;IACAkB;MAAA;MACA;MAEA;MACAlB;QACAV;QACA6B;QACAC;QACAR;UACA;UACA;YACA;cACAC;YACA;UACA;QACA;MACA;IACA;IACAQ;MACA;QACA;QACA,+DACAC,iBACAC;UACAC;QAAA,EACA;QAEA;QACA;UACAxB;YACAV;YACA2B;UACA;UACA;QACA;QAEAQ;UACAC;UACAtC;YACAuC;YACAvC;cACAwC;cACAL;YACA;UACA;QACA;UACA;YACAvB;cACAV;cACA2B;YACA;YAEAhB;cACAD;YACA;UACA;YACAA;cACAV;cACA2B;YACA;UACA;QACA;UACAT;UACAR;YACAV;YACA2B;UACA;QACA;MACA;QACAT;QACAR;UACAV;UACA2B;QACA;MACA;IACA;IACAY;MACA;QACAC;QACA;MACA;IACA;IACAC;MACA;MAEA;QACAhB;MACA;MAEA;IACA;IACAiB;MACA;QACA;UACA;UACA;YACAjB,+ZAWA;UACA;QACA;MACA;IACA;IACAkB;MAAA;MACA,20CAmCA;MAEA;QACA;QACA;UACAlB;YACA;cACA;YACA;cACA;YACA;UACA;QACA;MACA;IACA;IACAmB;MACA;QACA;QACA;UACAnB,4JAIA;YACAP;UACA;QACA;MACA;IACA;IACA2B;MAAA;MACAnC;QACAV;MACA;MAEA;QACA,2/DA2CA;QAEA;UACA;UACA;YACAyB;cACAf;cAEA;gBACAQ;gBACA;cACA;gBACAA;gBACA;cACA;YACA;UACA;YACAR;YACA;UACA;QACA;UACAA;UACA;QACA;MACA;QACAA;QACAQ;QACA;MACA;IACA;IACA4B;MACA;MACApC;IACA;IACAqC;MACArC;QACAV;QACA2B;MACA;MACA;IACA;EAAA,iGAEA;IAAA;IAAA;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;cAEAjB;gBAAAV;cAAA;;cAEA;cAAA;cAAA,OACA;gBACAU;kBACAY;kBACA0B;gBACA;cACA;YAAA;cALAC;cAAA;cAAA,OAQA;gBACAvC;kBACAwC;kBACAC;kBACA7B;oBAAA;kBAAA;kBACA0B;gBACA;cACA;YAAA;cAPAI;cAAA;cAAA,OAUAjB;gBACAC;gBACAtC;kBACAuD;kBACAC;gBACA;cACA;YAAA;cANAC;cAQA;cACAC;cAEA;gBACA;gBACA9C;kBACAV;kBACAmB;kBACAC;kBACAC;kBACAC;oBACA;sBACA;oBACA;kBACA;gBACA;cACA;gBACAZ;kBACAV;kBACA2B;gBACA;cACA;cAAA;cAAA;YAAA;cAAA;cAAA;cAGAT;cACAR;gBACAV;gBACA2B;cACA;YAAA;cAAA;cAEAjB;cAAA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EAEA,sFAGA+C;IACA;MACA;MACA;QACAlC;QACAmC;QACAC;MACA;MAAA,2CAEAC;QAAA;MAAA;QAAA;UAAA;UACA;;UAEA;UACA;YACA;YACA;cACAJ;YACA;UACA;UACA;UAAA,KACA;YACA;YACA;cACAA;YACA;UACA;UACA;UAAA,KACA;YACA;YACA;cACAA;YACA;UACA;UACA;UAAA,KACA;YACAA;UACA;QACA;MAAA;QAAA;MAAA;QAAA;MAAA;MAEA;IACA;MACAtC;MACA;IACA;EACA;AAEA;AAAA,2B;;;;;;;;;;;;;ACpkBA;AAAA;AAAA;AAAA;AAAm3B,CAAgB,o3BAAG,EAAC,C;;;;;;;;;;;ACAv4B;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/webview/webview.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './pages/webview/webview.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./webview.vue?vue&type=template&id=baadaa0c&\"\nvar renderjs\nimport script from \"./webview.vue?vue&type=script&lang=js&\"\nexport * from \"./webview.vue?vue&type=script&lang=js&\"\nimport style0 from \"./webview.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/webview/webview.vue\"\nexport default component.exports","export * from \"-!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./webview.vue?vue&type=template&id=baadaa0c&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./webview.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./webview.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"webview-container\">\r\n    <web-view \r\n      :src=\"url\" \r\n      @message=\"handleMessage\"\r\n      @onPostMessage=\"handlePostMessage\"\r\n      @load=\"handlePageLoad\"\r\n      @error=\"handlePageError\">\r\n    </web-view>\r\n    <canvas canvas-id=\"screenCanvas\" class=\"hidden-canvas\"></canvas>\r\n    \r\n    <!-- 修改原有的fixed-controls -->\r\n    <view class=\"fixed-controls\">\r\n      <button class=\"capture-btn\" @tap=\"captureAndRecognize\">截图识别</button>\r\n      <button class=\"manual-btn\" @tap=\"getSchoolInfoManually\">手动输入</button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      url: '',\r\n      title: '网页',\r\n      captureTimer: null,\r\n      processCount: 0,\r\n      maxCaptures: 5,\r\n      captureInterval: 8000,\r\n      lastCaptureTime: 0,\r\n      hasRecognized: false,\r\n      manualInputShown: false,\r\n      loading: true\r\n    }\r\n  },\r\n  onLoad(options) {\r\n    if (options.url) {\r\n      this.url = decodeURIComponent(options.url);\r\n      uni.showLoading({\r\n        title: '正在加载...'\r\n      });\r\n    }\r\n    if (options.title) {\r\n      this.title = decodeURIComponent(options.title);\r\n      uni.setNavigationBarTitle({\r\n        title: this.title\r\n      });\r\n    }\r\n    \r\n    // 添加自动识别（3秒后执行）\r\n    setTimeout(() => {\r\n      this.captureAndRecognizeDOM();\r\n    }, 3000);\r\n  },\r\n  onUnload() {\r\n    if (this.captureTimer) {\r\n      clearTimeout(this.captureTimer);\r\n      this.captureTimer = null;\r\n    }\r\n  },\r\n  onShow() {\r\n    this.$nextTick(() => {\r\n      const controls = document.querySelector('.fixed-controls');\r\n      if (controls) {\r\n        controls.style.display = 'flex';\r\n      }\r\n    });\r\n  },\r\n  methods: {\r\n    handleMessage(event) {\r\n      console.log('收到页面消息:', event.detail);\r\n      \r\n      const message = event.detail.data;\r\n      if (message && message.type === 'school_detected' && message.schoolName) {\r\n        this.stopAutoCapture();\r\n        \r\n        uni.showModal({\r\n          title: '检测到学校信息',\r\n          content: `您的学校是：${message.schoolName}，确认保存？`,\r\n          confirmText: '确认',\r\n          cancelText: '手动输入',\r\n          success: (res) => {\r\n            if (res.confirm) {\r\n              this.saveEducationInfo({\r\n                schoolName: message.schoolName\r\n              });\r\n            } else {\r\n              this.getSchoolInfoManually();\r\n            }\r\n          }\r\n        });\r\n      }\r\n    },\r\n    captureAndRecognize() {\r\n      if (this.hasRecognized) return;\r\n      \r\n      uni.showLoading({\r\n        title: '正在识别...'\r\n      });\r\n      \r\n      const quickScript = `\r\n        (function() {\r\n          if (document.body.innerText.includes('沈阳航空航天大学')) {\r\n            return '沈阳航空航天大学';\r\n          }\r\n          return '';\r\n        })();\r\n      `;\r\n      \r\n      const detailedScript = `\r\n        (function() {\r\n          if (document.body.innerText.includes('沈阳航空航天大学')) {\r\n            return '沈阳航空航天大学';\r\n          }\r\n          \r\n          const schoolTexts = [];\r\n          \r\n          const tables = document.querySelectorAll('table');\r\n          for (const table of tables) {\r\n            const rows = table.querySelectorAll('tr');\r\n            for (const row of rows) {\r\n              const text = row.innerText || '';\r\n              if (text.includes('院校名称') || text.includes('学校名称')) {\r\n                schoolTexts.push(text);\r\n              }\r\n            }\r\n          }\r\n          \r\n          const elements = document.querySelectorAll('.info-item, .cell, .item-row, div, p');\r\n          for (const el of elements) {\r\n            const text = el.innerText || '';\r\n            if (text.includes('院校名称') || text.includes('学校名称') || \r\n                text.includes('院校') || text.includes('大学') || \r\n                text.includes('学院')) {\r\n              schoolTexts.push(text);\r\n            }\r\n          }\r\n          \r\n          for (const text of schoolTexts) {\r\n            const match1 = text.match(/(院校名称|学校名称)[：:]+\\\\s*([^\\\\s][^\\\\r\\\\n]+)/);\r\n            if (match1 && match1[2]) {\r\n              return match1[2].trim();\r\n            }\r\n            \r\n            const match2 = text.match(/([\\\\u4e00-\\\\u9fa5]{2,}(大学|学院))/);\r\n            if (match2 && match2[1]) {\r\n              return match2[1].trim();\r\n            }\r\n          }\r\n          \r\n          return '';\r\n        })();\r\n      `;\r\n      \r\n      if (typeof plus !== 'undefined' && plus.webview) {\r\n        const currentWebview = plus.webview.currentWebview();\r\n        if (currentWebview && currentWebview.children && currentWebview.children().length > 0) {\r\n          currentWebview.children()[0].evalJS(quickScript, (quickResult) => {\r\n            if (quickResult) {\r\n              uni.hideLoading();\r\n              this.confirmSchool(quickResult);\r\n              this.hasRecognized = true;\r\n            } else {\r\n              currentWebview.children()[0].evalJS(detailedScript, (result) => {\r\n                uni.hideLoading();\r\n                \r\n                if (result) {\r\n                  console.log('识别到学校:', result);\r\n                  this.confirmSchool(result);\r\n                  this.hasRecognized = true;\r\n                } else {\r\n                  console.log('未识别到学校信息');\r\n                  this.getSchoolInfoManually();\r\n                }\r\n              });\r\n            }\r\n          });\r\n        } else {\r\n          uni.hideLoading();\r\n          this.getSchoolInfoManually();\r\n        }\r\n      } else {\r\n        uni.hideLoading();\r\n        this.getSchoolInfoManually();\r\n      }\r\n    },\r\n    confirmSchool(schoolName) {\r\n      this.saveEducationInfo({\r\n        schoolName: schoolName\r\n      });\r\n      \r\n      uni.showToast({\r\n        title: `已识别到${schoolName}`,\r\n        icon: 'success'\r\n      });\r\n      \r\n      setTimeout(() => {\r\n        uni.navigateBack();\r\n      }, 1500);\r\n    },\r\n    getSchoolInfoManually() {\r\n      if (this.manualInputShown) return;\r\n      \r\n      this.manualInputShown = true;\r\n      uni.showModal({\r\n        title: '请输入学校信息',\r\n        editable: true,\r\n        placeholderText: '例如: 沈阳航空航天大学',\r\n        success: (res) => {\r\n          this.manualInputShown = false;\r\n          if (res.confirm && res.content) {\r\n            this.saveEducationInfo({\r\n              schoolName: res.content.trim()\r\n            });\r\n          }\r\n        }\r\n      });\r\n    },\r\n    saveEducationInfo(educationInfo) {\r\n      try {\r\n        const selectedSchool = uni.getStorageSync('selectedSchool') || {};\r\n        const mergedInfo = {\r\n          ...selectedSchool,\r\n          ...educationInfo,\r\n          verified: true\r\n        };\r\n        \r\n        const userId = uni.getStorageSync('userId');\r\n        if (!userId) {\r\n          uni.showToast({\r\n            title: '请先登录',\r\n            icon: 'none'\r\n          });\r\n          return;\r\n        }\r\n        \r\n        uniCloud.callFunction({\r\n          name: 'user',\r\n          data: {\r\n            action: 'updateUserInfo',\r\n            data: {\r\n              userId,\r\n              educationInfo: mergedInfo\r\n            }\r\n          }\r\n        }).then(res => {\r\n          if (res.result.code === 0) {\r\n            uni.showToast({\r\n              title: '学籍验证成功',\r\n              icon: 'success'\r\n            });\r\n            \r\n            setTimeout(() => {\r\n              uni.navigateBack();\r\n            }, 1500);\r\n          } else {\r\n            uni.showToast({\r\n              title: res.result.message,\r\n              icon: 'none'\r\n            });\r\n          }\r\n        }).catch(err => {\r\n          console.error('保存失败', err);\r\n          uni.showToast({\r\n            title: '验证失败，请重试',\r\n            icon: 'none'\r\n          });\r\n        });\r\n      } catch (e) {\r\n        console.error('保存教育信息错误', e);\r\n        uni.showToast({\r\n          title: '操作失败',\r\n          icon: 'none'\r\n        });\r\n      }\r\n    },\r\n    stopAutoCapture() {\r\n      if (this.captureTimer) {\r\n        clearInterval(this.captureTimer);\r\n        this.captureTimer = null;\r\n      }\r\n    },\r\n    getCurrentWebview() {\r\n      let currentWebview = null;\r\n      \r\n      if (typeof plus !== 'undefined' && plus.webview) {\r\n        currentWebview = plus.webview.currentWebview();\r\n      }\r\n      \r\n      return currentWebview;\r\n    },\r\n    captureScreen() {\r\n      return new Promise((resolve, reject) => {\r\n        if (typeof plus !== 'undefined' && plus.webview) {\r\n          const currentWebview = plus.webview.currentWebview();\r\n          if (currentWebview && currentWebview.children && currentWebview.children().length > 0) {\r\n            currentWebview.children()[0].evalJS(`\r\n              (function() {\r\n                const bitmap = new plus.nativeObj.Bitmap('screen');\r\n                bitmap.loadBase64Data((data) => {\r\n                  resolve(data);\r\n                  bitmap.clear();\r\n                }, (error) => {\r\n                  reject(error);\r\n                  bitmap.clear();\r\n                });\r\n              })();\r\n            `);\r\n          }\r\n        }\r\n      });\r\n    },\r\n    getSchoolInfoFromWebview() {\r\n      const script = `\r\n        (function() {\r\n          const textElements = Array.from(document.querySelectorAll('*')).filter(el => \r\n            el.innerText && \r\n            el.innerText.trim() && \r\n            !['SCRIPT', 'STYLE'].includes(el.tagName)\r\n          );\r\n          \r\n          const syauElements = textElements.filter(el => \r\n            el.innerText.includes('沈阳航空航天大学')\r\n          );\r\n          \r\n          if (syauElements.length > 0) {\r\n            return '沈阳航空航天大学';\r\n          }\r\n          \r\n          for (const el of textElements) {\r\n            if (el.innerText.includes('院校名称') || el.innerText.includes('学校名称')) {\r\n              const text = el.innerText;\r\n              const matches = text.match(/(院校名称|学校名称)[：:]*\\\\s*([^\\\\r\\\\n]+)/);\r\n              if (matches && matches[2]) {\r\n                return matches[2].trim();\r\n              }\r\n            }\r\n          }\r\n          \r\n          for (const el of textElements) {\r\n            const matches = el.innerText.match(/([\\\\u4e00-\\\\u9fa5]+大学)/);\r\n            if (matches && matches[1]) {\r\n              return matches[1];\r\n            }\r\n          }\r\n          \r\n          return null;\r\n        })();\r\n      `;\r\n      \r\n      if (typeof plus !== 'undefined' && plus.webview) {\r\n        const currentWebview = plus.webview.currentWebview();\r\n        if (currentWebview && currentWebview.children && currentWebview.children().length > 0) {\r\n          currentWebview.children()[0].evalJS(script, result => {\r\n            if (result) {\r\n              this.confirmSchool(result);\r\n            } else {\r\n              this.getSchoolInfoManually();\r\n            }\r\n          });\r\n        }\r\n      }\r\n    },\r\n    debugHtml() {\r\n      if (typeof plus !== 'undefined' && plus.webview) {\r\n        const currentWebview = plus.webview.currentWebview();\r\n        if (currentWebview && currentWebview.children && currentWebview.children().length > 0) {\r\n          currentWebview.children()[0].evalJS(`\r\n            (function() {\r\n              return document.documentElement.outerHTML;\r\n            })();\r\n          `, (html) => {\r\n            console.log('页面HTML前1000个字符:', html.substring(0, 1000));\r\n          });\r\n        }\r\n      }\r\n    },\r\n    captureAndRecognizeDOM() {\r\n      uni.showLoading({\r\n        title: '正在识别学校...'\r\n      });\r\n      \r\n      try {\r\n        const script = `\r\n          (function() {\r\n            if (document.documentElement.innerHTML.includes('沈阳航空航天大学')) {\r\n              return '沈阳航空航天大学';\r\n            }\r\n            \r\n            let schoolName = null;\r\n            \r\n            const tableRows = document.querySelectorAll('tr, .info-row, .item-row');\r\n            for (const row of tableRows) {\r\n              const text = row.innerText || '';\r\n              if (text.includes('院校名称') || text.includes('学校名称') || text.includes('院校')) {\r\n                const schoolMatch = text.match(/(院校名称|学校名称|院校)[：:\\\\s]*([^\\\\r\\\\n\\\\t]+)/);\r\n                if (schoolMatch && schoolMatch[2]) {\r\n                  return schoolMatch[2].trim();\r\n                }\r\n              }\r\n            }\r\n            \r\n            const infoItems = document.querySelectorAll('.info-item, .cell');\r\n            for (const item of infoItems) {\r\n              const text = item.innerText || '';\r\n              if (text.includes('院校名称') || text.includes('学校名称')) {\r\n                const schoolMatch = text.match(/(院校名称|学校名称)[：:\\\\s]*([^\\\\r\\\\n\\\\t]+)/);\r\n                if (schoolMatch && schoolMatch[2]) {\r\n                  return schoolMatch[2].trim();\r\n                }\r\n              }\r\n            }\r\n            \r\n            const allElements = document.querySelectorAll('*');\r\n            for (let i = 0; i < allElements.length; i++) {\r\n              const text = allElements[i].innerText || '';\r\n              if (text) {\r\n                const uniMatch = text.match(/([\\\\u4e00-\\\\u9fa5]{2,}(大学|学院))/);\r\n                if (uniMatch && uniMatch[1]) {\r\n                  return uniMatch[1];\r\n                }\r\n              }\r\n            }\r\n            \r\n            return null;\r\n          })();\r\n        `;\r\n        \r\n        if (typeof plus !== 'undefined' && plus.webview) {\r\n          const currentWebview = plus.webview.currentWebview();\r\n          if (currentWebview && currentWebview.children && currentWebview.children().length > 0) {\r\n            currentWebview.children()[0].evalJS(script, result => {\r\n              uni.hideLoading();\r\n              \r\n              if (result) {\r\n                console.log('DOM识别到学校:', result);\r\n                this.confirmSchool(result);\r\n              } else {\r\n                console.log('DOM未识别到学校信息');\r\n                this.getSchoolInfoManually();\r\n              }\r\n            });\r\n          } else {\r\n            uni.hideLoading();\r\n            this.getSchoolInfoManually();\r\n          }\r\n        } else {\r\n          uni.hideLoading();\r\n          this.getSchoolInfoManually();\r\n        }\r\n      } catch (error) {\r\n        uni.hideLoading();\r\n        console.error('DOM识别错误:', error);\r\n        this.getSchoolInfoManually();\r\n      }\r\n    },\r\n    handlePageLoad() {\r\n      this.loading = false;\r\n      uni.hideLoading();\r\n    },\r\n    handlePageError() {\r\n      uni.showToast({\r\n        title: '页面加载失败',\r\n        icon: 'none'\r\n      });\r\n      this.loading = false;\r\n    },\r\n    // 新增截图识别方法\r\n    async captureAndRecognize() {\r\n      try {\r\n        uni.showLoading({ title: '正在识别...' });\r\n        \r\n        // 1. 调用截屏API\r\n        const captureRes = await new Promise((resolve, reject) => {\r\n          uni.createScreenCapture({\r\n            success: resolve,\r\n            fail: reject\r\n          });\r\n        });\r\n\r\n        // 2. 将截图转为base64\r\n        const base64 = await new Promise((resolve, reject) => {\r\n          uni.getFileSystemManager().readFile({\r\n            filePath: captureRes.tempFilePath,\r\n            encoding: 'base64',\r\n            success: (res) => resolve(res.data),\r\n            fail: reject\r\n          });\r\n        });\r\n\r\n        // 3. 调用百度OCR API\r\n        const ocrResult = await uniCloud.callFunction({\r\n          name: 'baiduOCR',\r\n          data: {\r\n            image: base64,\r\n            type: 'general_basic' // 使用通用文字识别\r\n          }\r\n        });\r\n\r\n        // 4. 解析OCR结果\r\n        const schoolInfo = this.parseOCRResult(ocrResult.result);\r\n        \r\n        if (schoolInfo) {\r\n          // 显示识别结果确认框\r\n          uni.showModal({\r\n            title: '识别结果',\r\n            content: `识别到的学校：${schoolInfo.schoolName}\\n专业：${schoolInfo.major || '未识别'}\\n学历层次：${schoolInfo.degree || '未识别'}`,\r\n            confirmText: '确认',\r\n            cancelText: '重新识别',\r\n            success: (res) => {\r\n              if (res.confirm) {\r\n                this.saveEducationInfo(schoolInfo);\r\n              }\r\n            }\r\n          });\r\n        } else {\r\n          uni.showToast({\r\n            title: '未识别到学校信息',\r\n            icon: 'none'\r\n          });\r\n        }\r\n\r\n      } catch (error) {\r\n        console.error('识别失败:', error);\r\n        uni.showToast({\r\n          title: '识别失败，请重试',\r\n          icon: 'none'\r\n        });\r\n      } finally {\r\n        uni.hideLoading();\r\n      }\r\n    },\r\n\r\n    // 解析OCR结果\r\n    parseOCRResult(result) {\r\n      try {\r\n        const words = result.words_result || [];\r\n        let schoolInfo = {\r\n          schoolName: '',\r\n          major: '',\r\n          degree: ''\r\n        };\r\n\r\n        for (const item of words) {\r\n          const text = item.words;\r\n          \r\n          // 匹配学校名称\r\n          if (text.includes('学校名称') || text.includes('院校名称')) {\r\n            const match = text.match(/[：:]\\s*(.+)/);\r\n            if (match) {\r\n              schoolInfo.schoolName = match[1].trim();\r\n            }\r\n          }\r\n          // 匹配专业\r\n          else if (text.includes('专业')) {\r\n            const match = text.match(/专业[：:]\\s*(.+)/);\r\n            if (match) {\r\n              schoolInfo.major = match[1].trim();\r\n            }\r\n          }\r\n          // 匹配学历层次\r\n          else if (text.includes('学历层次') || text.includes('学历')) {\r\n            const match = text.match(/[：:]\\s*(.+)/);\r\n            if (match) {\r\n              schoolInfo.degree = match[1].trim();\r\n            }\r\n          }\r\n          // 直接匹配大学名称\r\n          else if (text.includes('大学') || text.includes('学院')) {\r\n            schoolInfo.schoolName = text.trim();\r\n          }\r\n        }\r\n\r\n        return schoolInfo.schoolName ? schoolInfo : null;\r\n      } catch (error) {\r\n        console.error('解析OCR结果失败:', error);\r\n        return null;\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.webview-container {\r\n  width: 100%;\r\n  height: 100vh;\r\n  position: relative;\r\n}\r\n\r\n.hidden-canvas {\r\n  position: absolute;\r\n  left: -9999px;\r\n  top: -9999px;\r\n  width: 100px;\r\n  height: 100px;\r\n}\r\n\r\n.fixed-controls {\r\n  position: fixed;\r\n  bottom: 40px;\r\n  right: 20px;\r\n  z-index: 99999;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 15px;\r\n  background: rgba(255, 255, 255, 0.9);\r\n  padding: 15px;\r\n  border-radius: 12px;\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n}\r\n\r\n.capture-btn {\r\n  background: #007AFF;\r\n  color: white;\r\n  padding: 12px 20px;\r\n  border-radius: 8px;\r\n  font-size: 14px;\r\n  min-width: 120px;\r\n  text-align: center;\r\n}\r\n\r\n.manual-btn {\r\n  background: #f0f0f0;\r\n  color: #333;\r\n  padding: 12px 20px;\r\n  border-radius: 8px;\r\n  font-size: 14px;\r\n  min-width: 120px;\r\n  text-align: center;\r\n}\r\n</style> ","import mod from \"-!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./webview.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Hbuilderx\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./webview.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1743160579721\n      var cssReload = require(\"D:/Hbuilderx/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}