<view class="container"><view class="message-nav"><view class="nav-buttons"><view data-event-opts="{{[['tap',[['changeTab',['interaction']]]]]}}" class="{{['nav-button',(currentType==='interaction')?'active':'']}}" bindtap="__e"><view class="{{['icon-circle','interaction-icon',(currentType==='interaction')?'active':'']}}"><text class="icon-text">👤</text></view><text class="nav-text">互动</text></view><view data-event-opts="{{[['tap',[['changeTab',['chat']]]]]}}" class="{{['nav-button',(currentType==='chat')?'active':'']}}" bindtap="__e"><view class="{{['icon-circle','chat-icon',(currentType==='chat')?'active':'']}}"><text class="icon-text">💬</text></view><text class="nav-text">聊天</text></view><view data-event-opts="{{[['tap',[['changeTab',['system']]]]]}}" class="{{['nav-button',(currentType==='system')?'active':'']}}" bindtap="__e"><view class="{{['icon-circle','system-icon',(currentType==='system')?'active':'']}}"><text class="icon-text">🔔</text></view><text class="nav-text">系统</text></view></view></view><view class="content-area"><block wx:if="{{currentType==='interaction'}}"><view class="message-list"><block wx:if="{{$root.g0}}"><view class="empty-tip">暂无互动消息</view></block><block wx:else><view class="interaction-list"><block wx:for="{{$root.l1}}" wx:for-item="item" wx:for-index="index" wx:key="_id"><view data-event-opts="{{[['tap',[['navigateToInteraction',['$0'],[[['interactionList','_id',item.$orig._id]]]]]],['longpress',[['showDeleteConfirm',['$0',index],[[['interactionList','_id',item.$orig._id]]]]]]]}}" class="interaction-item" bindtap="__e" bindlongpress="__e"><image class="avatar" src="{{item.$orig.senderAvatar}}" mode="aspectFill"></image><view class="interaction-content"><view class="interaction-header"><text class="nickname">{{item.$orig.senderNickname||'用户'}}</text><text class="time">{{item.m0}}</text></view><view class="interaction-body"><view class="content">{{item.$orig.displayContent||item.$orig.content||''}}</view><block wx:if="{{item.g1}}"><view data-event-opts="{{[['tap',[['previewCommentImage',['$0','$event'],[[['interactionList','_id',item.$orig._id,'fileID']]]]]]]}}" class="interaction-image" catchtap="__e"><image src="{{item.$orig.fileID[0]}}" mode="aspectFill"></image></view></block></view><block wx:if="{{item.$orig.postId}}"><view class="interaction-meta"><block wx:if="{{item.$orig.contentProcessed}}"><view class="interaction-post-info"><uni-icons vue-id="{{'7ac9e6a0-1-'+index}}" type="chatbubble" size="14" color="#999" bind:__l="__l"></uni-icons><text>{{item.$orig.postContent}}</text></view></block><block wx:else><view class="interaction-post-info"><uni-icons vue-id="{{'7ac9e6a0-2-'+index}}" type="info" size="14" color="#999" bind:__l="__l"></uni-icons><text>加载帖子内容中...</text></view></block><block wx:if="{{item.g2}}"><view class="post-images"><block wx:for="{{item.l0}}" wx:for-item="img" wx:for-index="imgIndex" wx:key="imgIndex"><view data-event-opts="{{[['tap',[['previewPostImage',['$0',imgIndex,'$event'],[[['interactionList','_id',item.$orig._id,'postImages']]]]]]]}}" class="post-image" catchtap="__e"><image src="{{img}}" mode="aspectFill"></image></view></block><block wx:if="{{item.g3>3}}"><text class="more-images">{{"+"+(item.g4-3)}}</text></block></view></block></view></block></view><block wx:if="{{!item.$orig.isRead}}"><view class="unread-dot"></view></block></view></block><block wx:if="{{interactionLoading}}"><view class="loading-more">加载中...</view></block></view></block></view></block><block wx:else><block wx:if="{{currentType==='chat'}}"><view class="message-list"><block wx:if="{{$root.g5}}"><view class="empty-tip">暂无聊天消息</view></block><block wx:else><view class="chat-list"><block wx:for="{{$root.l2}}" wx:for-item="item" wx:for-index="index" wx:key="_id"><view data-event-opts="{{[['tap',[['navigateToChat',['$0'],[[['chatList','_id',item.$orig._id]]]]]],['longpress',[['showChatDeleteConfirm',['$0',index],[[['chatList','_id',item.$orig._id]]]]]]]}}" class="chat-item" bindtap="__e" bindlongpress="__e"><image class="avatar" src="{{item.$orig.targetUserAvatar||'/static/images/default-avatar.png'}}" mode="aspectFill"></image><view class="chat-content"><view class="chat-header"><text class="nickname">{{item.$orig.targetUserNickname||'用户'}}</text><text class="time">{{item.m1}}</text></view><view class="chat-body"><text class="last-message">{{item.$orig.lastMessage||''}}</text></view></view><block wx:if="{{item.$orig.unreadCount>0}}"><view class="unread-badge">{{item.$orig.unreadCount>99?'99+':item.$orig.unreadCount}}</view></block></view></block><block wx:if="{{chatLoading}}"><view class="loading-more">加载中...</view></block></view></block></view></block><block wx:else><block wx:if="{{currentType==='system'}}"><view class="message-list"><view class="empty-tip">暂无系统消息</view></view></block></block></block></view></view>