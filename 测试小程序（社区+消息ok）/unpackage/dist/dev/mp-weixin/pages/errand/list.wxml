<view class="container"><view class="header"><view class="search-wrapper"><view class="search-bar"><view class="location-mini"><image class="location-icon" src="/static/images/local.png" mode="aspectFit"></image><text>{{currentSchool||'请认证'}}</text></view><view class="search-input"><uni-icons vue-id="24b54674-1" type="search" size="16" color="#666" bind:__l="__l"></uni-icons><input type="text" placeholder="搜索任务" data-event-opts="{{[['confirm',[['onSearch',['$event']]]],['input',[['__set_model',['','searchKeyword','$event',[]]]]]]}}" value="{{searchKeyword}}" bindconfirm="__e" bindinput="__e"/></view></view><view data-event-opts="{{[['tap',[['onSearch',['$event']]]]]}}" class="search-btn" bindtap="__e"><image class="search-icon" src="/static/images/icons/sousuo.png" mode="aspectFit"></image></view></view><scroll-view class="category-scroll" scroll-x="{{true}}" show-scrollbar="false"><view class="category-list"><block wx:for="{{categories}}" wx:for-item="category" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['switchCategory',[index]]]]]}}" class="{{['category-item',activeCategory===index?'active':'']}}" bindtap="__e"><text>{{category.name}}</text></view></block></view></scroll-view></view><scroll-view class="task-list" scroll-y="{{true}}" refresher-enabled="{{true}}" refresher-triggered="{{refreshing}}" data-event-opts="{{[['scrolltolower',[['loadMore',['$event']]]],['refresherrefresh',[['onRefresh',['$event']]]]]}}" bindscrolltolower="__e" bindrefresherrefresh="__e"><block wx:if="{{$root.g0===0}}"><view class="empty-state"><image src="/static/images/empty.png" mode="aspectFit"></image><text>{{emptyText}}</text></view></block><block wx:for="{{$root.l1}}" wx:for-item="task" wx:for-index="__i0__" wx:key="id"><view data-event-opts="{{[['tap',[['goToDetail',['$0'],[[['tasks','id',task.$orig.id]]]]]]]}}" class="task-card" bindtap="__e"><view class="user-info"><image class="avatar" src="{{task.$orig.userAvatar||'/static/images/avatar/default.png'}}" mode="aspectFill" data-event-opts="{{[['tap',[['viewUserProfile',['$0'],[[['tasks','id',task.$orig.id,'userId']]]]]]]}}" catchtap="__e"></image><view class="user-meta"><text class="nickname">{{task.$orig.userName}}</text><text class="publish-time">{{task.$orig.time}}</text></view><button data-event-opts="{{[['tap',[['startChat',['$0'],[[['tasks','id',task.$orig.id,'userId']]]]]]]}}" class="chat-btn" catchtap="__e"><uni-icons vue-id="{{'24b54674-2-'+__i0__}}" type="chat" size="18" color="#007AFF" bind:__l="__l"></uni-icons><text>私聊</text></button></view><view class="task-content"><view class="main-info"><text class="task-title">{{task.$orig.title}}</text><text class="task-reward">{{"¥"+task.$orig.price}}</text></view><text class="task-details">{{task.$orig.details}}</text><block wx:if="{{task.g1}}"><view class="image-list"><block wx:for="{{task.l0}}" wx:for-item="img" wx:for-index="imgIndex" wx:key="imgIndex"><image class="task-image" src="{{img}}" mode="aspectFill" data-event-opts="{{[['tap',[['previewImage',['$0','$1'],[[['tasks','id',task.$orig.id,'images']],[['tasks','id',task.$orig.id],['images.slice(0,3)','',imgIndex]]]]]]]}}" catchtap="__e"></image></block></view></block><view class="location-info"><uni-icons vue-id="{{'24b54674-3-'+__i0__}}" type="location" size="16" color="#666" bind:__l="__l"></uni-icons><text class="location-text">{{task.$orig.endAddress}}</text></view></view><view class="task-footer"><view class="tags"><block wx:if="{{task.$orig.urgent}}"><text class="tag">加急</text></block><text class="tag">{{task.$orig.category||'跑腿代取'}}</text><text class="tag status-tag active">待接单</text></view><button class="accept-btn" disabled="{{task.$orig.userId===currentUserId||isAccepting}}" data-event-opts="{{[['tap',[['acceptTask',['$0'],[[['tasks','id',task.$orig.id]]]]]]]}}" catchtap="__e">立即接单</button></view></view></block><block wx:if="{{$root.g2>0}}"><view class="loading-state"><block wx:if="{{loading}}"><text>加载中...</text></block><block wx:else><block wx:if="{{pagination.page>=pagination.totalPage}}"><text>没有更多了</text></block><block wx:else><text>上拉加载更多</text></block></block></view></block></scroll-view></view>