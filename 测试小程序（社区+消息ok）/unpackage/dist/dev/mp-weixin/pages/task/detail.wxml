<view class="container"><scroll-view class="content-scroll" scroll-y="{{true}}" scroll-with-animation="{{true}}" data-event-opts="{{[['scrolltolower',[['loadMoreComments',['$event']]]]]}}" bindscrolltolower="__e"><block wx:if="{{detail&&detail.userInfo}}"><view class="user-info"><view class="user-left"><image class="avatar" src="{{detail.userInfo.avatar||'/static/images/default-avatar.png'}}" data-event-opts="{{[['tap',[['gotoUserPage',['$0'],['detail.userInfo._id']]]]]}}" bindtap="__e"></image><view class="user-meta"><text class="nickname">{{detail.userInfo.nickname||'用户'}}</text><text class="time">{{$root.m0}}</text></view></view><view class="user-right"><block wx:if="{{userId&&detail.userInfo&&userId!==detail.userInfo._id}}"><button data-event-opts="{{[['tap',[['toggleFollow',['$event']]]]]}}" class="{{['follow-btn',(isFollowing)?'following':'']}}" bindtap="__e"><block wx:if="{{!isFollowing}}"><text class="follow-icon-text">+</text></block><block wx:else><text class="follow-icon-text">✓</text></block><text>{{isFollowing?'已关注':'关注'}}</text></button></block></view></view></block><block wx:if="{{detail}}"><view class="content"><block wx:if="{{detail.content}}"><view class="content-text">{{detail.content}}</view></block><block wx:if="{{$root.g0}}"><view class="image-grid"><block wx:for="{{detail.images}}" wx:for-item="image" wx:for-index="index" wx:key="index"><image src="{{image}}" mode="aspectFill" data-event-opts="{{[['tap',[['previewImage',[index]]]]]}}" bindtap="__e"></image></block></view></block></view></block><view class="action-bar"><view class="action-item comment"><image class="action-icon" src="/static/images/icons/pinglun.png" mode="aspectFit"></image><text>{{detail.commentCount||0}}</text><text>评论</text></view><view data-event-opts="{{[['tap',[['handleLike',['$event']]]]]}}" class="action-item like" bindtap="__e"><image class="{{['action-icon',(detail.isLiked)?'liked':'']}}" src="{{detail.isLiked?'/static/images/heart-filled.png':'/static/images/heart.png'}}" mode="aspectFit"></image><text class="{{[(detail.isLiked)?'liked':'']}}">{{''+($root.g1?$root.g2:detail.likeCount>0?detail.likeCount:'点赞')+''}}</text></view></view><view class="comment-section"><view class="comment-header"><view class="header-tabs"><view data-event-opts="{{[['tap',[['switchTab',['comment']]]]]}}" class="{{['tab-item',(activeTab==='comment')?'active':'']}}" bindtap="__e"><text>{{"评论 "+(detail.commentCount||0)}}</text></view><view data-event-opts="{{[['tap',[['switchTab',['like']]]]]}}" class="{{['tab-item',(activeTab==='like')?'active':'']}}" bindtap="__e"><text>{{"点赞 "+(detail.likeCount||0)}}</text></view></view><block wx:if="{{$root.g3}}"><view class="comment-filter"><view class="comment-sort-options"><view data-event-opts="{{[['tap',[['setSortType',['time']]]]]}}" class="{{['sort-option',(sortType==='time')?'active':'']}}" bindtap="__e"><text>按时间</text></view><view data-event-opts="{{[['tap',[['setSortType',['hot']]]]]}}" class="{{['sort-option',(sortType==='hot')?'active':'']}}" bindtap="__e"><text>按热度</text></view></view></view></block></view><block wx:if="{{activeTab==='comment'}}"><view class="comment-list"><block wx:if="{{$root.g4}}"><view class="loading-state"><uni-icons vue-id="7ee66894-1" type="spinner-cycle" size="24" color="#999" bind:__l="__l"></uni-icons><text>加载评论中...</text></view></block><block wx:else><block wx:if="{{!$root.g5}}"><view class="empty-state"><text class="empty-text">暂无评论，快来发表第一条评论吧</text></view></block><block wx:else><view class="comment-items"><block wx:for="{{$root.l0}}" wx:for-item="comment" wx:for-index="index" wx:key="_id"><block wx:if="{{comment.$orig.status!==0}}"><view class="{{['comment-item',(comment.$orig._id===highlightedCommentId)?'highlighted':'']}}" data-comment-id="{{comment.$orig._id}}" data-event-opts="{{[['longpress',[['showCommentActions',['$0'],[[['comments','_id',comment.$orig._id]]]]]]]}}" bindlongpress="__e"><image class="comment-avatar" src="{{comment.$orig.userInfo?comment.$orig.userInfo.avatar||'/static/images/default-avatar.png':'/static/images/default-avatar.png'}}" mode="aspectFill" data-event-opts="{{[['tap',[['gotoUserPage',['$0'],[[['comments','_id',comment.$orig._id,'userId']]]]]]]}}" bindtap="__e"></image><view class="comment-right"><view class="comment-user"><text class="comment-nickname">{{comment.$orig.userInfo?comment.$orig.userInfo.nickname||'用户':'用户'}}</text></view><block wx:if="{{comment.$orig.replyTo}}"><view class="reply-info"><text class="reply-text">回复</text><text class="reply-nickname">{{comment.$orig.replyUserInfo?comment.$orig.replyUserInfo.nickname||'用户':'用户'}}</text></view></block><view class="comment-content"><text class="comment-text">{{comment.$orig.content}}</text><block wx:if="{{comment.$orig.image}}"><view class="comment-image-container"><image class="comment-image" src="{{comment.$orig.image}}" mode="widthFix" data-event-opts="{{[['tap',[['previewCommentImage',['$0'],[[['comments','_id',comment.$orig._id,'image']]]]]],['error',[['handleImageError',['$0'],[[['comments','_id',comment.$orig._id]]]]]]]}}" bindtap="__e" binderror="__e"></image></view></block></view><view class="comment-footer"><text class="comment-time">{{comment.m1}}</text><view class="comment-actions"><view data-event-opts="{{[['tap',[['replyComment',['$0'],[[['comments','_id',comment.$orig._id]]]]]]]}}" class="action-item" bindtap="__e"><image class="action-icon-small" src="/static/images/icons/pinglun.png" mode="aspectFit"></image><text>回复</text></view><view data-event-opts="{{[['tap',[['likeComment',['$0'],[[['comments','_id',comment.$orig._id]]]]]]]}}" class="action-item" bindtap="__e"><image class="{{['action-icon-small',(comment.$orig.isLiked)?'liked':'',(comment.$orig.likeLoading)?'like-loading':'',(comment.$orig.animating)?'like-animate':'']}}" src="{{comment.$orig.isLiked?'/static/images/heart-filled.png':'/static/images/heart.png'}}" mode="aspectFit"></image><text class="{{[(comment.$orig.isLiked)?'liked':'']}}">{{comment.$orig.likeCount>0?comment.$orig.likeCount:'点赞'}}</text></view></view></view></view></view></block></block></view></block></block></view></block><block wx:if="{{activeTab==='like'}}"><view class="like-users-list"><block wx:if="{{$root.g6}}"><view class="loading-state"><uni-icons vue-id="7ee66894-2" type="spinner-cycle" size="24" color="#999" bind:__l="__l"></uni-icons><text>加载点赞用户中...</text></view></block><block wx:else><block wx:if="{{!$root.g7}}"><view class="empty-state"><text class="empty-text">暂无点赞</text></view></block><block wx:else><block wx:for="{{likeUsers}}" wx:for-item="user" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['gotoUserPage',['$0'],[[['likeUsers','',index,'_id']]]]]]]}}" class="like-user-item" bindtap="__e"><image class="like-user-avatar" src="{{user.avatar||'/static/images/default-avatar.png'}}" mode="aspectFill" data-event-opts="{{[['error',[['handleUserAvatarError',['$0'],[[['likeUsers','',index]]]]]]]}}" binderror="__e"></image><view class="like-user-info"><text class="like-user-nickname">{{user.nickname||'用户'}}</text><text class="like-user-time">{{user.likeTimeText||'刚刚'}}</text></view></view></block></block></block></view></block></view></scroll-view><view class="bottom-bar"><view data-event-opts="{{[['tap',[['showCommentPopup',['$event']]]]]}}" class="input-box" bindtap="__e">说点什么...</view><view class="bottom-actions"><view data-event-opts="{{[['tap',[['showCommentPopup',['$event']]]]]}}" class="action-btn" bindtap="__e"><image class="action-btn-icon" src="/static/images/icons/aite.png"></image></view><view data-event-opts="{{[['tap',[['showCommentPopup',['$event']]]]]}}" class="action-btn" bindtap="__e"><image class="action-btn-icon" src="/static/images/icons/tupian.png"></image></view></view></view><comment-popup class="vue-ref" vue-id="7ee66894-3" detail="{{detail}}" replyInfo="{{replyInfo}}" postId="{{detail._id}}" data-ref="commentPopup" data-event-opts="{{[['^submit',[['handleCommentSubmit']]],['^cancel',[['e0']]]]}}" bind:submit="__e" bind:cancel="__e" bind:__l="__l"></comment-popup><uni-load-more vue-id="7ee66894-4" status="{{loadingStatus}}" bind:__l="__l"></uni-load-more><block wx:if="{{showUserSearchBox}}"><view class="user-search-box"><view class="search-input-wrap"><input type="text" placeholder="搜索用户" focus="{{true}}" data-event-opts="{{[['input',[['__set_model',['','userSearchKeyword','$event',[]]],['handleUserSearchInput',['$event']]]]]}}" value="{{userSearchKeyword}}" bindinput="__e"/></view><block wx:if="{{userSearchLoading}}"><view class="user-search-loading"><uni-icons vue-id="7ee66894-5" type="spinner-cycle" size="18" color="#999" bind:__l="__l"></uni-icons><text>搜索中...</text></view></block><scroll-view class="user-search-results" scroll-y="{{true}}"><block wx:for="{{userSearchResults}}" wx:for-item="user" wx:for-index="__i0__" wx:key="_id"><view data-event-opts="{{[['tap',[['selectUserToMention',['$0'],[[['userSearchResults','_id',user._id]]]]]]]}}" class="user-search-item" bindtap="__e"><image class="user-avatar" src="{{user.avatar||'/static/images/default-avatar.png'}}" mode="aspectFill"></image><view class="user-info"><text class="user-nickname">{{user.nickname||'用户'}}</text><text class="user-signature">{{user.signature||'这个人很懒，什么都没写'}}</text></view></view></block><block wx:if="{{$root.g8}}"><view class="no-results"><text>未找到匹配的用户</text></view></block></scroll-view></view></block><block wx:if="{{__DEV__}}"><button data-event-opts="{{[['tap',[['debugFollowStatus',['$event']]]]]}}" class="debug-btn" bindtap="__e">检查关注状态</button></block></view>