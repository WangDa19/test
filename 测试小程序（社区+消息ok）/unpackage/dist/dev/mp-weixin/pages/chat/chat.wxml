<view class="chat-container"><view class="nav-bar"><uni-icons vue-id="6e1d75c0-1" type="arrow-left" size="30" color="#333" data-event-opts="{{[['^tap',[['goBack']]]]}}" bind:tap="__e" bind:__l="__l"></uni-icons><text class="nav-title">{{targetUserName}}</text></view><scroll-view class="message-list" scroll-y="{{true}}" scroll-top="{{scrollTop}}" refresher-triggered="{{refreshing}}" data-event-opts="{{[['scrolltolower',[['loadMore',['$event']]]],['refresherrefresh',[['onRefresh',['$event']]]]]}}" bindscrolltolower="__e" bindrefresherrefresh="__e"><block wx:if="{{$root.g0===0}}"><view class="empty-state"><text>暂无消息，开始聊天吧</text></view></block><block wx:else><view class="message-container"><block wx:for="{{groupedMessages}}" wx:for-item="group" wx:for-index="groupIndex" wx:key="groupIndex"><block><view class="time-divider"><text>{{group.date}}</text></view><block wx:for="{{group.messages}}" wx:for-item="item" wx:for-index="index" wx:key="_id"><view data-event-opts="{{[['longpress',[['showMessageActions',['$0'],[[['groupedMessages','',groupIndex],['messages','_id',item._id]]]]]]]}}" class="{{['message-item',item.isSelf?'self':'other']}}" bindlongpress="__e"><image class="avatar" src="{{item.userInfo.avatar||'/static/images/avatar/default.png'}}" mode="aspectFill" data-event-opts="{{[['error',[['handleAvatarError',['$0','$1'],['e',[['groupedMessages','',groupIndex],['messages','_id',item._id]]]]]]]}}" binderror="__e"></image><view class="message-content"><text class="message-text">{{item.content}}</text></view></view></block></block></block></view></block></scroll-view><view class="input-area"><input type="text" placeholder="请输入消息" data-event-opts="{{[['confirm',[['sendMessage',['$event']]]],['input',[['__set_model',['','inputContent','$event',[]]]]]]}}" value="{{inputContent}}" bindconfirm="__e" bindinput="__e"/><button class="send-btn" disabled="{{!$root.g1}}" data-event-opts="{{[['tap',[['sendMessage',['$event']]]]]}}" bindtap="__e">发送</button></view></view>